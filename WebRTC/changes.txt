WebRTC 1:N 다자간 통화 안정화 변경 내용 (4명까지 지원)
========================================================

1. 백엔드 (SignalingHandler.java)

- room-info 메시지 추가: 새 사용자 입장 시 기존 참여자 목록을 전송
- 새 사용자가 먼저 기존 참여자들에게 연결을 시작할 수 있게 됨

2. DTO (SignalMessage.java)

- participants 필드 추가 (기존 참여자 목록 전송용)

3. 프론트엔드 (index.html)

TURN 서버 추가
// OpenRelay 무료 TURN 서버 추가
turn:openrelay.metered.ca:80
turn:openrelay.metered.ca:443
turn:openrelay.metered.ca:443?transport=tcp

핵심 로직 개선
┌───────────────────────────────┬───────────────────────────────────────────────────┐
│             기능              │                       설명                        │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ handleRoomInfo()              │ 기존 참여자 목록 받아서 순차 연결 (200ms 간격)    │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ pendingIceCandidates          │ ICE candidate 버퍼링 (타이밍 문제 해결)           │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ processPendingIceCandidates() │ 버퍼링된 ICE candidate 처리                       │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ ICE 재시작                    │ 연결 실패/끊김 시 자동 restartIce() 호출          │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ 연결 상태 표시                │ 각 참여자 비디오에 상태 표시 (녹색/노란색/빨간색) │
├───────────────────────────────┼───────────────────────────────────────────────────┤
│ 중복 연결 방지                │ 이미 연결된 피어 체크                             │
└───────────────────────────────┴───────────────────────────────────────────────────┘

---

연결 흐름 (개선 후)

A 입장 → 방에 혼자
B 입장 → room-info로 [A] 받음 → B가 A에게 offer
        → A에게 user-joined 알림 → A도 B에게 offer (중복 방지됨)
C 입장 → room-info로 [A, B] 받음 → C가 A, B에게 각각 offer
        → A, B에게 user-joined 알림
D 입장 → room-info로 [A, B, C] 받음 → D가 A, B, C에게 각각 offer

---

테스트 방법

./gradlew bootRun
1. 브라우저 탭 4개 열기
2. 같은 방 이름으로 순차 입장
3. 4명 모두 서로 영상이 보이는지 확인

TURN 서버가 포함되어 NAT 환경에서도 연결이 더 안정적으로 됩니다.

========================================================
프론트엔드 API 명세
========================================================

1. REST API
-----------------------------------------------------------

[GET] /api/rooms
- 설명: 모든 활성 방 목록 조회
- 응답:
  [
    { "roomId": "방이름", "participantCount": 2 },
    { "roomId": "다른방", "participantCount": 1 }
  ]

[GET] /api/rooms/count
- 설명: 활성 방 개수 조회
- 응답: 3 (숫자)

[GET] /api/rooms/{roomId}/exists
- 설명: 특정 방 존재 여부 및 참여자 수 확인
- 예시: /api/rooms/myroom/exists
- 응답:
  { "exists": true, "participantCount": 2 }

[GET] /room/{roomId}
- 설명: 특정 방으로 바로 입장 (초대 링크용)
- 예시: /room/myroom
- 동작: index.html 로드 후 자동으로 해당 방에 입장 시도

-----------------------------------------------------------

2. WebSocket API
-----------------------------------------------------------

엔드포인트: ws://{host}/signal (또는 wss://)

[클라이언트 → 서버 메시지]

join
- 설명: 방 입장
- 형식:
  {
    "type": "join",
    "roomId": "방이름"
  }

offer
- 설명: SDP offer 전송
- 형식:
  {
    "type": "offer",
    "targetId": "상대방세션ID",
    "roomId": "방이름",
    "payload": { RTCSessionDescription }
  }

answer
- 설명: SDP answer 전송
- 형식:
  {
    "type": "answer",
    "targetId": "상대방세션ID",
    "roomId": "방이름",
    "payload": { RTCSessionDescription }
  }

ice-candidate
- 설명: ICE candidate 전송
- 형식:
  {
    "type": "ice-candidate",
    "targetId": "상대방세션ID",
    "roomId": "방이름",
    "payload": { RTCIceCandidate }
  }

leave
- 설명: 방 퇴장
- 형식:
  {
    "type": "leave",
    "roomId": "방이름"
  }

-----------------------------------------------------------

[서버 → 클라이언트 메시지]

room-info (신규 추가)
- 설명: 입장 시 기존 참여자 목록 전달
- 형식:
  {
    "type": "room-info",
    "roomId": "방이름",
    "senderId": "내세션ID",
    "participants": ["세션ID1", "세션ID2", "세션ID3"]
  }

user-joined
- 설명: 새 사용자 입장 알림
- 형식:
  {
    "type": "user-joined",
    "roomId": "방이름",
    "senderId": "새사용자세션ID"
  }

user-left
- 설명: 사용자 퇴장 알림
- 형식:
  {
    "type": "user-left",
    "roomId": "방이름",
    "senderId": "퇴장한사용자세션ID"
  }

offer
- 설명: 다른 사용자로부터 offer 수신
- 형식:
  {
    "type": "offer",
    "roomId": "방이름",
    "senderId": "발신자세션ID",
    "payload": { RTCSessionDescription }
  }

answer
- 설명: 다른 사용자로부터 answer 수신
- 형식:
  {
    "type": "answer",
    "roomId": "방이름",
    "senderId": "발신자세션ID",
    "payload": { RTCSessionDescription }
  }

ice-candidate
- 설명: 다른 사용자로부터 ICE candidate 수신
- 형식:
  {
    "type": "ice-candidate",
    "roomId": "방이름",
    "senderId": "발신자세션ID",
    "payload": { RTCIceCandidate }
  }

-----------------------------------------------------------

3. WebSocket 연결 흐름 예시
-----------------------------------------------------------

1) WebSocket 연결
   const ws = new WebSocket('ws://localhost:8080/signal');

2) 방 입장
   ws.send(JSON.stringify({ type: 'join', roomId: 'myroom' }));

3) room-info 수신 → 기존 참여자들에게 offer 전송
   handleRoomInfo(message) → 각 participant에게 createOffer()

4) user-joined 수신 → 새 사용자에게 offer 전송
   handleUserJoined(peerId) → createOffer()

5) offer 수신 → answer 응답
   handleOffer(message) → createAnswer()

6) answer 수신 → 연결 완료
   handleAnswer(message) → setRemoteDescription()

7) ICE candidate 교환
   handleIceCandidate(message) → addIceCandidate()

8) 방 퇴장
   ws.send(JSON.stringify({ type: 'leave', roomId: 'myroom' }));
   ws.close();
